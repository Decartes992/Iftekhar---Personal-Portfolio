---
/**
 * Base layout component for all pages
 *
 * @module BaseLayout
 * @description Provides the common structure for all pages including head, header, main content, and footer.
 * Handles theme initialization, page transitions, and scroll animations.
 *
 * @prop {string} title - Page title.
 * @prop {string} [description='Iftekhar - Personal Portfolio'] - Page meta description.
 * @prop {Date} [lastUpdated] - The date the content was last updated. Passed to the footer.
 * @prop {boolean} [withGradientBackground=false] - If true, applies an animated gradient to the background.
 *
 * @example
 * <BaseLayout title="Home" withGradientBackground={true}>
 * <!-- Page content -->
 * </BaseLayout>
 */
import '../styles/global.css';
import { ViewTransitions } from 'astro:transitions';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import CustomCursor from '../components/CustomCursor.jsx';
import 'aos/dist/aos.css';

interface Props {
    title: string;
    description?: string;
    lastUpdated?: Date;
    withGradientBackground?: boolean;
}

const {
    title,
    description = 'Iftekhar - Personal Portfolio',
    lastUpdated,
    withGradientBackground = false,
} = Astro.props;
---

<!doctype html>
<html lang="en" class="scroll-smooth">
    <head>
        <meta charset="UTF-8" />
        <meta name="description" content={description} />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <title>{title} | Iftekhar Rafi - Software Engineer</title>

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Satoshi:wght@400;500;700&display=swap"
            rel="stylesheet"
        />

        <!-- Astro View Transitions for smooth page navigation -->
        <ViewTransitions fallback="animate" />

        <!-- 
          Theme Manager Script:
          This inline script runs before the page is rendered to prevent a "flash of unstyled content" (FOUC).
          It checks localStorage and the user's system preference to apply the 'dark' class to the <html> element if needed.
          This is the core of the theme switching logic.
        -->
        <script is:inline>
            const getTheme = () => {
                if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
                    return localStorage.getItem('theme');
                }
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    return 'dark';
                }
                return 'light';
            };

            const theme = getTheme();

            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        </script>

        <!-- 
          The inline <style> tag has been removed. 
          All styles, including the optional gradient background, are now correctly handled in `src/styles/global.css`.
          This prevents style conflicts and improves maintainability.
        -->
    </head>

    <body class:list={[
        // This Astro directive conditionally adds the 'with-gradient-background' class
        // to the body if the `withGradientBackground` prop is true on a page.
        { 'with-gradient-background': withGradientBackground }
    ]}>
        <CustomCursor client:only="jsx" />
        <Header />

        <main
            id="main-content"
            class="mx-auto w-full max-w-screen-2xl flex-grow px-6 py-16 sm:px-8 md:py-20 lg:px-12"
        >
            <slot />
        </main>

        <Footer {lastUpdated} />

        <!-- External script for Animate on Scroll library -->
        <script src="/scripts/aos.js" defer></script>
        
        <!-- Script to initialize animations on each page load -->
        <script>
            // This declaration informs TypeScript that a global 'AOS' object will exist at runtime,
            // resolving the "Cannot find name 'AOS'" error.
            declare const AOS: any;

            document.addEventListener('astro:page-load', () => {
                if (typeof AOS !== 'undefined') {
                    AOS.init({
                        duration: 800,
                        once: true, // Animation happens only once
                    });
                }
            });
        </script>
    </body>
</html>
